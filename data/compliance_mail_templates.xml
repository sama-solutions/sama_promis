<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Mail Template: Compliance Task Reminder -->
    <record id="mail_template_compliance_task_reminder" model="mail.template">
        <field name="name">Compliance Task Reminder</field>
        <field name="model_id" ref="model_sama_promis_compliance_task"/>
        <field name="subject">Rappel: T√¢che de Conformit√© - ${object.name}</field>
        <field name="email_from">${(object.company_id.email or user.email_formatted) | safe}</field>
        <field name="email_to">${object.responsible_id.email | safe}</field>
        <field name="body_html" type="html">
            <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">
                <div style="background-color: #f8d7da; border: 1px solid #f5c6cb; padding: 15px; border-radius: 5px; margin-bottom: 20px;">
                    <h2 style="color: #721c24; margin: 0;">Rappel: T√¢che de Conformit√©</h2>
                </div>
                
                <p>Bonjour <strong>${object.responsible_id.name}</strong>,</p>
                
                <p>Ceci est un rappel concernant la t√¢che de conformit√© suivante qui approche de son √©ch√©ance:</p>
                
                <div style="background-color: #f8f9fa; border-left: 4px solid #007bff; padding: 15px; margin: 20px 0;">
                    <h3 style="margin-top: 0; color: #007bff;">${object.name}</h3>
                    <table style="width: 100%; border-collapse: collapse;">
                        <tr>
                            <td style="padding: 5px 0;"><strong>Projet:</strong></td>
                            <td style="padding: 5px 0;">${object.project_id.name if object.project_id else 'N/A'}</td>
                        </tr>
                        <tr>
                            <td style="padding: 5px 0;"><strong>Contrat:</strong></td>
                            <td style="padding: 5px 0;">${object.contract_id.name if object.contract_id else 'N/A'}</td>
                        </tr>
                        <tr>
                            <td style="padding: 5px 0;"><strong>Type:</strong></td>
                            <td style="padding: 5px 0;">${dict(object._fields['task_type'].selection).get(object.task_type, object.task_type)}</td>
                        </tr>
                        <tr>
                            <td style="padding: 5px 0;"><strong>Priorit√©:</strong></td>
                            <td style="padding: 5px 0;">${dict(object._fields['priority'].selection).get(object.priority, object.priority)}</td>
                        </tr>
                        <tr>
                            <td style="padding: 5px 0;"><strong>√âch√©ance:</strong></td>
                            <td style="padding: 5px 0; color: #d9534f; font-weight: bold;">${format_date(object.deadline)}</td>
                        </tr>
                        <tr>
                            <td style="padding: 5px 0;"><strong>Jours restants:</strong></td>
                            <td style="padding: 5px 0;">${object.days_until_deadline} jour(s)</td>
                        </tr>
                    </table>
                </div>
                
                % if object.description:
                <div style="margin: 20px 0;">
                    <h4>Description:</h4>
                    <div style="background-color: #ffffff; border: 1px solid #dee2e6; padding: 10px; border-radius: 3px;">
                        ${object.description}
                    </div>
                </div>
                % endif
                
                % if object.requires_document:
                <div style="background-color: #fff3cd; border: 1px solid #ffeaa7; padding: 10px; border-radius: 3px; margin: 20px 0;">
                    <strong>‚ö†Ô∏è Attention:</strong> Cette t√¢che requiert la soumission de documents justificatifs.
                </div>
                % endif
                
                <div style="margin: 30px 0; text-align: center;">
                    <a href="${ctx.get('base_url', '')}/web#id=${object.id}&amp;model=sama.promis.compliance.task&amp;view_type=form" 
                       style="background-color: #007bff; color: white; padding: 12px 30px; text-decoration: none; border-radius: 5px; display: inline-block;">
                        Voir la T√¢che
                    </a>
                </div>
                
                <p style="color: #6c757d; font-size: 12px; margin-top: 30px; border-top: 1px solid #dee2e6; padding-top: 15px;">
                    Ce message a √©t√© envoy√© automatiquement par le syst√®me SAMA PROMIS.<br/>
                    Pour toute question, veuillez contacter votre gestionnaire de projet.
                </p>
            </div>
        </field>
    </record>

    <!-- Mail Template: Compliance Task Escalation -->
    <record id="mail_template_compliance_task_escalation" model="mail.template">
        <field name="name">Compliance Task Escalation</field>
        <field name="model_id" ref="model_sama_promis_compliance_task"/>
        <field name="subject">URGENT: T√¢che de Conformit√© en Retard - ${object.name}</field>
        <field name="email_from">${(object.company_id.email or user.email_formatted) | safe}</field>
        <field name="email_to">${object.responsible_id.email | safe}</field>
        <field name="email_cc">${','.join([u.email for u in object.project_id.created_by if object.project_id and object.project_id.created_by]) if object.project_id else ''}</field>
        <field name="body_html" type="html">
            <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">
                <div style="background-color: #dc3545; color: white; padding: 20px; border-radius: 5px; margin-bottom: 20px;">
                    <h2 style="margin: 0;">üö® ESCALADE: T√¢che de Conformit√© en Retard</h2>
                </div>
                
                <p>Bonjour <strong>${object.responsible_id.name}</strong>,</p>
                
                <p style="color: #dc3545; font-weight: bold;">
                    La t√¢che de conformit√© suivante est maintenant EN RETARD et n√©cessite une action imm√©diate:
                </p>
                
                <div style="background-color: #f8d7da; border-left: 4px solid #dc3545; padding: 15px; margin: 20px 0;">
                    <h3 style="margin-top: 0; color: #721c24;">${object.name}</h3>
                    <table style="width: 100%; border-collapse: collapse;">
                        <tr>
                            <td style="padding: 5px 0;"><strong>Projet:</strong></td>
                            <td style="padding: 5px 0;">${object.project_id.name if object.project_id else 'N/A'}</td>
                        </tr>
                        <tr>
                            <td style="padding: 5px 0;"><strong>Contrat:</strong></td>
                            <td style="padding: 5px 0;">${object.contract_id.name if object.contract_id else 'N/A'}</td>
                        </tr>
                        <tr>
                            <td style="padding: 5px 0;"><strong>Type:</strong></td>
                            <td style="padding: 5px 0;">${dict(object._fields['task_type'].selection).get(object.task_type, object.task_type)}</td>
                        </tr>
                        <tr>
                            <td style="padding: 5px 0;"><strong>Priorit√©:</strong></td>
                            <td style="padding: 5px 0; color: #dc3545; font-weight: bold;">
                                ${dict(object._fields['priority'].selection).get(object.priority, object.priority)}
                            </td>
                        </tr>
                        <tr>
                            <td style="padding: 5px 0;"><strong>√âch√©ance:</strong></td>
                            <td style="padding: 5px 0; color: #dc3545; font-weight: bold;">${format_date(object.deadline)}</td>
                        </tr>
                        <tr>
                            <td style="padding: 5px 0;"><strong>Jours de retard:</strong></td>
                            <td style="padding: 5px 0; color: #dc3545; font-weight: bold; font-size: 18px;">
                                ${object.days_overdue} jour(s)
                            </td>
                        </tr>
                        <tr>
                            <td style="padding: 5px 0;"><strong>√âtat actuel:</strong></td>
                            <td style="padding: 5px 0;">${dict(object._fields['state'].selection).get(object.state, object.state)}</td>
                        </tr>
                    </table>
                </div>
                
                % if object.description:
                <div style="margin: 20px 0;">
                    <h4>Description:</h4>
                    <div style="background-color: #ffffff; border: 1px solid #dee2e6; padding: 10px; border-radius: 3px;">
                        ${object.description}
                    </div>
                </div>
                % endif
                
                <div style="background-color: #fff3cd; border: 1px solid #ffc107; padding: 15px; border-radius: 3px; margin: 20px 0;">
                    <h4 style="margin-top: 0; color: #856404;">‚ö†Ô∏è Actions Requises:</h4>
                    <ul style="margin: 10px 0; padding-left: 20px;">
                        <li>Compl√©ter la t√¢che imm√©diatement</li>
                        % if object.requires_document:
                        <li>Soumettre les documents requis</li>
                        % endif
                        % if object.requires_approval:
                        <li>Demander l'approbation n√©cessaire</li>
                        % endif
                        <li>Informer le gestionnaire de projet de tout blocage</li>
                    </ul>
                </div>
                
                % if object.compliance_profile_id:
                <div style="margin: 20px 0;">
                    <p><strong>Profil de Conformit√©:</strong> ${object.compliance_profile_id.name}</p>
                    <p style="color: #6c757d; font-size: 14px;">
                        Le non-respect des d√©lais de conformit√© peut avoir des cons√©quences sur le financement du projet.
                    </p>
                </div>
                % endif
                
                <div style="margin: 30px 0; text-align: center;">
                    <a href="${ctx.get('base_url', '')}/web#id=${object.id}&amp;model=sama.promis.compliance.task&amp;view_type=form" 
                       style="background-color: #dc3545; color: white; padding: 12px 30px; text-decoration: none; border-radius: 5px; display: inline-block; font-weight: bold;">
                        Traiter Imm√©diatement
                    </a>
                </div>
                
                <p style="color: #6c757d; font-size: 12px; margin-top: 30px; border-top: 1px solid #dee2e6; padding-top: 15px;">
                    Ce message d'escalade a √©t√© envoy√© automatiquement par le syst√®me SAMA PROMIS.<br/>
                    Une copie a √©t√© envoy√©e au gestionnaire de projet.<br/>
                    Pour toute urgence, veuillez contacter imm√©diatement votre superviseur.
                </p>
            </div>
        </field>
    </record>

    <!-- Mail Template: Compliance Report Due Soon -->
    <record id="mail_template_compliance_report_due_soon" model="mail.template">
        <field name="name">Compliance Report Due Soon</field>
        <field name="model_id" ref="model_sama_promis_contract"/>
        <field name="subject">Rappel: Rapport de Conformit√© √† Soumettre - ${object.name}</field>
        <field name="email_from">${(object.company_id.email or user.email_formatted) | safe}</field>
        <field name="email_to">${object.project_id.created_by.email if object.project_id and object.project_id.created_by else user.email | safe}</field>
        <field name="body_html" type="html">
            <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">
                <div style="background-color: #fff3cd; border: 1px solid #ffc107; padding: 15px; border-radius: 5px; margin-bottom: 20px;">
                    <h2 style="color: #856404; margin: 0;">Rappel: Rapport de Conformit√©</h2>
                </div>
                
                <p>Bonjour,</p>
                
                <p>Le prochain rapport de conformit√© pour le contrat suivant doit √™tre soumis prochainement:</p>
                
                <div style="background-color: #f8f9fa; border-left: 4px solid #ffc107; padding: 15px; margin: 20px 0;">
                    <h3 style="margin-top: 0;">${object.name}</h3>
                    <table style="width: 100%; border-collapse: collapse;">
                        <tr>
                            <td style="padding: 5px 0; width: 40%;"><strong>Projet:</strong></td>
                            <td style="padding: 5px 0;">${object.project_id.name}</td>
                        </tr>
                        <tr>
                            <td style="padding: 5px 0;"><strong>B√©n√©ficiaire:</strong></td>
                            <td style="padding: 5px 0;">${object.partner_id.name}</td>
                        </tr>
                        <tr>
                            <td style="padding: 5px 0;"><strong>Profil de Conformit√©:</strong></td>
                            <td style="padding: 5px 0;">${object.compliance_profile_id.name if object.compliance_profile_id else 'N/A'}</td>
                        </tr>
                        <tr>
                            <td style="padding: 5px 0;"><strong>Fr√©quence:</strong></td>
                            <td style="padding: 5px 0;">${dict(object._fields['reporting_frequency'].selection).get(object.reporting_frequency, object.reporting_frequency)}</td>
                        </tr>
                        <tr>
                            <td style="padding: 5px 0;"><strong>Dernier Rapport:</strong></td>
                            <td style="padding: 5px 0;">${format_date(object.last_compliance_report_date) if object.last_compliance_report_date else 'Aucun'}</td>
                        </tr>
                        <tr>
                            <td style="padding: 5px 0;"><strong>Prochain Rapport:</strong></td>
                            <td style="padding: 5px 0; color: #ffc107; font-weight: bold;">${format_date(object.next_report_date)}</td>
                        </tr>
                    </table>
                </div>
                
                <div style="background-color: #d1ecf1; border: 1px solid #bee5eb; padding: 15px; border-radius: 3px; margin: 20px 0;">
                    <h4 style="margin-top: 0; color: #0c5460;">üìä Statistiques de Conformit√©</h4>
                    <ul style="margin: 10px 0; padding-left: 20px;">
                        <li>Taux de conformit√©: <strong>${object.compliance_rate}%</strong></li>
                        <li>T√¢ches compl√©t√©es: <strong>${object.compliance_tasks_completed} / ${object.compliance_task_count}</strong></li>
                        <li>T√¢ches en retard: <strong>${object.overdue_compliance_tasks}</strong></li>
                    </ul>
                </div>
                
                <div style="margin: 30px 0; text-align: center;">
                    <a href="${ctx.get('base_url', '')}/web#id=${object.id}&amp;model=sama.promis.contract&amp;view_type=form" 
                       style="background-color: #007bff; color: white; padding: 12px 30px; text-decoration: none; border-radius: 5px; display: inline-block; margin-right: 10px;">
                        Voir le Contrat
                    </a>
                    <a href="${ctx.get('base_url', '')}/web#action=action_generate_compliance_report&amp;id=${object.id}" 
                       style="background-color: #28a745; color: white; padding: 12px 30px; text-decoration: none; border-radius: 5px; display: inline-block;">
                        G√©n√©rer le Rapport
                    </a>
                </div>
                
                <p style="color: #6c757d; font-size: 12px; margin-top: 30px; border-top: 1px solid #dee2e6; padding-top: 15px;">
                    Ce rappel a √©t√© envoy√© automatiquement par le syst√®me SAMA PROMIS.
                </p>
            </div>
        </field>
    </record>
</odoo>
